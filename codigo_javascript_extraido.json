[
  {
    "script_num": 17,
    "tipo": "inline",
    "codigo": "function submitForm(sender, skipCustomization) {var form = $(sender).parents('form').first(); if (form.valid() == false) {return false; } else if(window.hasPricingEngineError == true) {$([document.documentElement, document.body]).animate({scrollTop: $('#priceErrorMessage').offset().top - 10}, 500); return false;}$('#___skipCustomization').val(skipCustomization); window.kendo.ui.progress($('.addToCartButton'), true); return true; }"
  },
  {
    "script_num": 33,
    "tipo": "inline",
    "codigo": "\nwindow.dataLayer = window.dataLayer || []\ndataLayer.push({\n  'transactionId': '',\n   'transactionAffiliation': 'Loja Grafica Eskenazi',\n   'transactionTotal': $(\".cartSummaryOrderTotal span\").text() || $(\".checkoutSummaryOrderTotal span\").text(),\n   'transactionTax': 0.00,\n   'transactionProducts': [{\n       'sku': '',\n       'name': $(\".cartProductName\").text(),\n       'category': '',\n       'price': $(\".cartProductPrice\").text(),\n       'quantity': $(\".cartProductQty\").text()\n   }]\n});\n\n"
  },
  {
    "script_num": 57,
    "tipo": "inline",
    "codigo": "\n\n      var existingUploadedFilesSeq = [];\n\n\n      function hideFileUploadSelect(fileInputElement){\n          //hide file input parent element as before, prevent break custom skins\n          var $parent = $(fileInputElement).parent();\n          $parent.hide();\n\n          //if parent element is not top level file upload controls wrapper then find it with .fileUploadSelect and hide it\n          if(!$parent.hasClass('fileUploadSelect')){\n              $(fileInputElement).closest('.fileUploadSelect').hide();\n          }\n      }\n\n      function showFileUploadSelect(fileInputElement){\n          //show file input parent element as before\n          var $parent = $(fileInputElement).parent();\n          $parent.show();\n\n          //if parent element is not top level file upload controls wrapper then find it with .fileUploadSelect and show it\n          if(!$parent.hasClass('fileUploadSelect')){\n              $(fileInputElement).closest('.fileUploadSelect').show();\n          }\n      }\n\n      window.calcFinish = function(sender, args) {\n          if(args.Requirements && args.Requirements.Files){\n              //required files is a valid array, then obey the array contents\n\n              //if no files are required, hide the whole upload area\n              if(args.Requirements.Files.length) {\n                  $('.fileUploadArea').show();\n              }else{\n                  $('.fileUploadArea').hide();\n              }\n\n              //and only display the expected upload fields\n              $.each($('.product-file-input'), function(i, e) {\n                  if(args.Requirements.Files.indexOf($(e).data('misid')) < 0) {\n                      hideFileUploadSelect(e);\n                  } else {\n                      showFileUploadSelect(e);\n                  }\n              });\n          } else {\n              //required files is NULL then show all upload fiels\n              $('.fileUploadArea').show();\n\n              $.each($('.product-file-input'), function(i, e) {\n                  if(!$(e).is(':visible')) {\n                      showFileUploadSelect(e);\n                  }\n              });\n          }\n      }\n\n\n      function printEstimate() {\n          var estimateUrl = \"/product/impressao-de-livro/printestimate\";\n\n          var kitQuantity = 0;\n          if ($(\"#txtKitQuantity\").length > 0) {\n              kitQuantity = $(\"#txtKitQuantity\").val();\n          }\n          var shippingCostTable = '';\n          if (document.getElementById(\"tCosts\")  !== null) {\n              shippingCostTable = document.getElementById(\"tCosts\").innerHTML;\n          }\n\n          $(\"#windowcontainer\").html(\"<div id='dynamicContainer'></div>\");\n\n          $(\"#dynamicContainer\").kendoWindow({\n              width: \"80%\",\n              height: \"70%\",\n              position: { top: 150, left: 150 },\n              modal: true,\n              visible: false,\n              content: {\n                  url: estimateUrl,\n                  data: JSON.stringify({ quantity: kitQuantity, pricingParameters: getPricingParameters(), shippingCost: shippingCostTable }),\n                  dataType: \"html\",\n                  contentType: \"application/json; charset=utf-8;\",\n                  type: \"POST\"\n              },\n              deactivate: function (e) {\n                  e.sender.destroy();\n              }\n          }).data(\"kendoWindow\").center().open();\n      }\n\n\t      \n            function removeExistingFile(seq)\n            {\n                $(\".fileUploadSelect\"+ seq).removeClass(\"hidden\");\n                $(\"#existingFileDiv\"+ seq).addClass(\"hidden\");\n\n                $(\"#existingFile\"+seq).val(\"\");\n            }\n\n            function hideFileUpload()\n            {\n                for(var i = 0; i < existingUploadedFilesSeq.length; i++)\n                {\n                    $(\".fileUploadSelect\"+ existingUploadedFilesSeq[i]).addClass(\"hidden\");\n                }\n            }\n         \n\n\n\n\n      $(function () {\n          // ajax fileupload\n          $('.product-file-input').each(function() {\n              var $fileInput = $(this);\n              var $fileIdInput = $('#fileUploadId-' + $fileInput.attr('data-seq'));\n              // build progress bar\n              var $progressContainer = $('.file-upload-progress[data-fileinput=\"'+ $fileInput.attr('id') +'\"]'); // id like fileUploads[0]\n              initProgressContainer();\n\n              var $progressBar = $progressContainer.find('.file-progress-bar-inner');\n              var $progressStatus = $progressContainer.find('.file-progress-status');\n              var $progressPercentage = $progressContainer.find('.file-progress-percentage');\n              var $progressErrorMsg = $progressContainer.find('.file-progress-error-msg');\n              var $btnCancel = $progressContainer.find('.btn-progress-cancel');\n              var $btnRemove = $progressContainer.find('.btn-progress-remove');\n              var $btnRetry = $progressContainer.find('.btn-progress-retry');\n\n              function initProgressContainer() {\n                  $progressContainer.html('<div class=\"file-progress-control\"><div class=\"file-progress-info\"><div class=\"file-progress-header\"><div class=\"file-progress-status\">Uploading</div><div class=\"file-progress-percentage\">80%</div></div><div class=\"file-progress-bar\"><div class=\"file-progress-bar-inner\"></div></div></div><div class=\"file-progress-actions\"><button class=\"btn btn-sm btn-default btn-progress-cancel\" type=\"button\">Cancel</button><button class=\"btn btn-sm btn-warning btn-progress-retry\" type=\"button\">Retry</button><button class=\"btn btn-sm btn-danger btn-progress-remove\" type=\"button\">Remove</button></div></div><div class=\"alert alert-danger file-progress-error-msg\"></div>');\n              }\n\n              var currentFile = null;\n              var xhr = null;\n\n              function resetUI() {\n                  $progressContainer.hide().removeAttr('data-status');\n                  $progressBar.width('0%');\n                  $progressPercentage.text('');\n                  $progressStatus.text('');\n                  $progressErrorMsg.hide().text('');\n              }\n\n              function setFileId(fileId) {\n                  $fileInput.attr('data-fileid', fileId);\n                  $fileIdInput.val(fileId);\n              }\n\n              function clearFileId() {\n                  $fileInput.attr('data-fileid', '');\n                  $fileIdInput.val('');\n              }\n\n              function resetFileStates() {\n                  $fileInput.val('');\n                  $fileInput.closest('.fileUploadSelect').find('.file-upload-name').val('');\n                  currentFile = null;\n\n                  clearFileId()\n              }\n\n              function upload(file) {\n                  // clear last stored fileId when start a new upload\n                  clearFileId();\n\n                  // log in progress file upload counts\n                  var inProgressCount = parseInt($('body').attr('data-uploading-files') || '0', 10);\n                  inProgressCount++;\n                  $('body').attr('data-uploading-files', inProgressCount);\n                  // disable add to cart button\n                  $(\"#btnAddToCartButton, #btnCustomizeButton\").attr('disabled', 'disabled');\n\n                  $fileInput.attr('disabled', 'disabled');\n                  if ($fileInput.parent().hasClass('btn')) {\n                      $fileInput.parent().addClass('disabled')\n                  }\n\n                  $progressContainer.show().attr('data-status', 'uploading');\n                  $progressStatus.text('Uploading');\n                  $progressBar.width('0%');\n                  $progressPercentage.text('0%');\n                  $progressErrorMsg.hide().text('');\n\n                  var formData = new FormData();\n                  formData.append('file', file);\n\n                  xhr = $.ajax({\n                      url: '/productfileupload',\n                      type: 'POST',\n                      data: formData,\n                      processData: false,\n                      contentType: false,\n                      xhr: function () {\n                          var x = new window.XMLHttpRequest();\n                          x.upload.addEventListener('progress', function (e) {\n                              if (e.lengthComputable) {\n                                  var percent = Math.round((e.loaded / e.total) * 100);\n                                  $progressBar.width(percent + '%');\n                                  $progressPercentage.text(percent + '%');\n                              }\n                          });\n                          return x;\n                      },\n                      success: function (res) {\n                          if (res.success && res.fileId) {\n                              // success\n                              $progressContainer.attr('data-status', 'complete');\n                              $progressStatus.text('Complete');\n                              $progressPercentage.text('100%');\n\n                              // store fileId\n                              setFileId(res.fileId);\n                          } else {\n                              // failed\n                              $progressContainer.attr('data-status', 'failed');\n                              $progressStatus.text('Failed');\n                              $progressPercentage.text('');\n                              $progressErrorMsg.show().text(res.error);\n                          }\n                      },\n                      error: function (req, status, err) {\n                          if (status !== 'abort') {\n                              $progressContainer.attr('data-status', 'failed');\n                              $progressStatus.text('Failed');\n                              $progressPercentage.text('');\n                              $progressBar.width('100%');\n                              $progressErrorMsg.show().text('Network Error. ' + err);\n                          }\n                      },\n                      complete: function () {\n                          $fileInput.removeAttr('disabled');\n                          if ($fileInput.parent().hasClass('btn')) {\n                              $fileInput.parent().removeClass('disabled');\n                          }\n                          xhr = null;\n\n                          // enable the add to cart button\n                          var count = parseInt($('body').attr('data-uploading-files') || '0', 10);\n                          count--;\n                          $('body').attr('data-uploading-files', count);\n                          if ($('body').attr('data-updating-price') !== 'true' && parseInt($('body').attr('data-uploading-files') || '0', 10) <= 0) {\n                              $('#btnAddToCartButton, #btnCustomizeButton').removeAttr('disabled');\n                          }\n                      }\n                  });\n              }\n\n              // file input change event\n              $fileInput.on('change', function() {\n                  if (this.files && this.files.length > 0) {\n                      currentFile = this.files[0];\n                      resetUI();\n                      upload(currentFile);\n                  }\n              });\n\n              // if user already selected a file before dom ready trigger change event\n              if ($fileInput[0] && $fileInput[0].files && $fileInput[0].files.length) {\n                  $fileInput.trigger('change');\n              }\n\n              $btnRetry.on('click', function () {\n                  if (currentFile) {\n                      upload(currentFile);\n                  }\n              });\n\n              $btnCancel.on('click', function () {\n                  if (xhr) {\n                      xhr.abort();\n                      resetUI();\n                      resetFileStates();\n                  }\n              });\n\n              $btnRemove.on('click', function () {\n                  resetUI();\n                  resetFileStates();\n              });\n          });\n\n\t      \n          hideFileUpload();\n          $(\"form.productForm\").submit(function (e) {\n              e.preventDefault();\n\n              // clear file upload input value, we do not send it with form\n              $.each($('.product-file-input'), function () {\n                  $(this).val(null);\n              });\n\n              \n              var fileUploaded = 0;\n              var counter = 0;\n              $.each($('.product-file-input'), function (i, e) {\n                  var fileId = $('#fileUploadId-' + counter).val();\n                  var existingFileVal = $('#existingFile' + counter).val();\n                  if (fileId !== '' && fileId !== null && fileId !== undefined) {\n                      fileUploaded = 1;\n                  }\n                  else if (existingFileVal !== \"\" && existingFileVal !== null && existingFileVal !== undefined) {\n                      fileUploaded = 1;\n                  }\n                  counter++;\n              });\n\n              if (fileUploaded == 0) {\n                  window.kendo.ui.progress($('.addToCartButton'), false);\n\n                  $('#fileUploadWarn').removeClass('hidden');\n                  $('#fileUploadWarn').addClass('alert alert-danger');\n                  $('html, body').animate({ scrollTop: $('.fileUploadArea').offset().top }, 'slow');\n              }\n              else {\n                  $('#fileUploadWarn').removeClass(\"alert-danger\");\n                  this.submit();\n              }\n\n              \n\n          });\n\n          \n\n          $(\"#shipToAddress\").removeClass(\"form-control\").kendoDropDownList({\n              footerTemplate: '#if(\"False\" == \"True\"){#<div class=\"dropdown-footer\"><a href=\"\" onclick=\"AddAddress(); return false;\"> Adicionar novo endere√ßo</a></div>#}#',\n              filter: \"contains\",\n              dataTextField: \"text\",\n              dataValueField: \"value\",\n              change: function(e) {\n                  var value = this.value();\n                  $(\"#detailPage_shippingCalculatorResults\").html(\"\");\n              }\n          });\n\n          $(\"#btnShipCost\").on('click',function (e) {\n              e.preventDefault();\n              $(document).trigger(\"shippingEstimate:start\");\n              kendo.ui.progress($(\"#detailPage_shippingCalculator\"), true);\n\n              var data = {\n                  countryCode: $(\"#ddlCountryCode\").val(),\n                  postalCode: $(\"#txtPostalCode\").val(),\n                  weight: $(\"#hdnTotalWeight\").val(),\n                  cost: $(\"#hdnTotalCost\").val(),\n                  stateProv: $(\"#ddlStateCode\").val(),\n                  city: $(\"#txtcity\").val()\n              };\n\n              $.ajax({\n                  url: \"/Cart/ShippingEstimate\",\n                  type: \"POST\",\n                  data: JSON.stringify(data),\n                  dataType: \"json\",\n                  contentType: \"application/json; charset=utf-8;\"\n              })\n              .done(function (result) {\n                  $(\"#detailPage_shippingCalculatorResults\").html(result[\"html\"]);\n                  kendo.ui.progress($(\"#detailPage_shippingCalculator\"), false);\n                  $(document).trigger(\"shippingEstimate:finish\");\n              })\n              .fail(function (e) {\n                  console.error(\"Cart/ShippingEstimate AJAX ERROR: \", e);\n              });\n\n          });\n\n          showHideStateProv();\n          setValidatorDefaults();\n      }); //end jquery ready\n\n      function setValidatorDefaults(){\n          // this must be used after kendoDropdownList on shiptoAddress\n          jQuery.validator.setDefaults({\n              errorPlacement: function (error, element) {\n                  if ((element.attr(\"type\") == \"checkbox\" || element.attr(\"type\") == \"radio\") && $(element).parents('ol').length > 0) {\n                      error.insertAfter($(element).parents('ol').first());\n                  } else {\n                      error.appendTo($(element).parent());\n                  }\n              },\n              errorClass: \"label label-danger\",\n              highlight: function (element, errorClass, validClass) {\n                  return false;\n              },\n              unhighlight: function (element, errorClass, validClass) {\n                  return false;\n              },\n              ignore: [] // this setting will stop ignoring of hidden fields\n          });\n      }\n\n      function showHideStateProv() {\n          var shipState = $(\"#divShippingStateProv\");\n          var shipCity = $(\"#divShippingCity\");\n          var postalCode = $(\"#txtPostalCode\");\n          var shipCalcPC = $(\"#detailPage_shippingCalculatorPostalCode\");\n          var countryCode = $(\"#ddlCountryCode\");\n          var shipStateLabel = $(\"#detailPage_shippingCalculatorPostalCode-State\");\n\n          if('False' == 'True' || (countryCode.val() && countryCode.val().toLowerCase() == \"ca\") || (countryCode.val() && countryCode.val().toLowerCase() == \"us\" && 'False' == 'True'))\n          {\n              //for canada, US with Fedex Freight and Zone Shipping is enabled\n              shipState.show();\n              shipCity.show();\n              postalCode.show();\n              shipCalcPC.show();\n              $(\"#ddlStateCode\").val(\"\");\n              $(\"#txtcity\").val(\"\");\n              $(\"#txtPostalCode\").val(\"\");\n              loadStatesForCountries();\n          }\n          else if (countryCode.val() && countryCode.val().toLowerCase() == \"id\") {\n              //indonesia\n              shipCalcPC.hide();\n              postalCode.hide().val(\"\");\n              shipState.hide();\n              shipCity.show();\n          } else {\n              shipState.hide();\n              $(\"#ddlStateCode\").val(\"\");\n              shipCity.hide();\n              $(\"#txtcity\").val(\"\");\n              shipCalcPC.show();\n              postalCode.show();\n          }\n\n          if (countryCode.val() && countryCode.val().toLowerCase() == \"ie\")\n          {\n              shipStateLabel.html('Select County');\n          }\n          else\n          {\n              shipStateLabel.html('Selecione Estado/Prov&#237;ncia');\n          }\n      }\n      function loadStatesForCountries()\n      {\n          var selectedCountry = $(\"#ddlCountryCode\").val();\n          var shipState = $('#ddlStateCode');\n          shipState.empty();\n          if (selectedCountry != null && selectedCountry != '')\n          {\n              $.getJSON('/Collections/States', { countryCode: selectedCountry },\n\n                function (States)\n                {\n                    if (States != null && !jQuery.isEmptyObject(States))\n                    {\n                        shipState.append($('<option/>',\n                            {\n                                value: null,\n                                text: \"Select\"\n                            }));\n                        $.each(States, function (index, state)\n                        {\n                            shipState.append($('<option/>',\n                            {\n                                value: state.StateCode,\n                                text: state.StateName\n                            }));\n                        });\n                    };\n                });\n          }\n\n      }\n    "
  }
]